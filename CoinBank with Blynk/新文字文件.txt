#define BLYNK_TEMPLATE_ID "TMPL6yT9dVA4g"
#define BLYNK_TEMPLATE_NAME "Coin Bank"
#define BLYNK_AUTH_TOKEN "57W5Ehi30MIawC4XVUP9CJ4Er6yiXyea"

#define BLYNK_PRINT Serial

#include <ESP8266WiFi.h>
#include <BlynkSimpleEsp8266.h>

// Your WiFi credentials.
// Set password to "" for open networks.
char ssid[] = "SC_iPhone";
char pass[] = "asdfghjkl";

BlynkTimer timer;
int coinCount = 0;

void sendData() {
  if (Serial.available() > 0) {
    String receivedString = Serial.readStringUntil('\n');  // 讀取直到換行符的整個字符串
    coinCount = receivedString.toInt();  // 將接收到的字符串轉換為整數
    Serial.println(coinCount);

    Blynk.virtualWrite(V1, coinCount);
  }
}

void setup() {
  // Debug console
  Serial.begin(115200);

  Blynk.begin(BLYNK_AUTH_TOKEN, ssid, pass);
  // You can also specify server:
  //Blynk.begin(BLYNK_AUTH_TOKEN, ssid, pass, "blynk.cloud", 80);
  //Blynk.begin(BLYNK_AUTH_TOKEN, ssid, pass, IPAddress(192,168,1,100), 8080);

  timer.setInterval(1000L, sendData);  // 設置定時器，每秒鐘發送數據
}

void loop() {
  Blynk.run();
  timer.run();
}
